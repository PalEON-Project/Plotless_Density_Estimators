# Plotless_Density_Estimators
  * Tree patterns were simulated from known spatial point processes and sampled in R.
  * Code Authors: Charles Cogbill, Andrew Thurman
  * This is code used for the simulations in: Cobill et al. 2018. A retrospective on the accuracy and precision of plotless forest density estimators in ecological studies. Ecosphere. Accepted.  

# Methods and Results from the Simulations

# Simulation of PDE performance under non-CSR patterns: Methods

Due to the lack of comprehensive quantitative evaluations of PDE performance under non-CSR processes, here we evaluate the accuracy of sixteen common PDEs by applying them to simulated patterns.  Tree patterns were simulated from known spatial point processes and sampled in R code written by the authors (R Core Development Team 2015). We used the distances from random sample points to the nearest event in simulated patterns generated from processes that, in addition to CSR, contained various levels of aggregation, inhibition, and inhomogeneity (Fig. 1, Table 3). Aggregation (or inhibition) refers to when two events occur nearer (or farther) than expected under CSR. Inhomogeneity occurs when events arise independently of one another, but the intensity of events (local average density) varies among locations. All simulations were for unit squares, and by convention, we define each unit to be 100 meters; thus, a simulation distance of 0.01 unit equals 1 meter, and density per unit area is directly equivalent to trees per hectare (t/ha). To accommodate edge effects, a constant width perimeter (generally 0.1 unit = 10 m) was pre-specified and the true density is calculated omitting this restricted area.  

We used several approaches for spatial patterns and sampling designs to mimic realistic forests and their field sampling.  All three inhibition patterns (InHib, Table 3) impose repulsion at local scales, and at large distances or high densities, the resultant patterns become very regular (Appendix S1: Table S1).  Inhomogeneous patterns (InHom, Table 3) were generated in two ways, one with a spatially varying density in a single realization and the other with multiple realizations of the same process but with different densities. For the single realization simulation, we used a CSR process with a density function that had a minimum at the center of the unit square varying by a power function to a maximum in each quarter corner (Fig. 1 left, Appendix S1: Table S1). The dual inhibited-inhomogeneous (InH2, Table 3) pattern starts with either inhomogeneous process above and then thins events according to a MaternII (elimination of one event if within an inhibition distance of another) process.  The dual inhibited-inhomogeneous simulation creates a pattern of countervailing local inhibition and regional aggregation grading from regular to inhomogeneous. We calculate the distance from 50 randomly selected sample points in each simulated data set, mimicking a single stand sample. Each simulation was run for 1000 to 5000 replications, depending on complexity and run time.    

Multiple realizations of events were generated from the various processes described above and placing a single central or random sample point in each pattern (Fig. 1 center). The inhomogeneous process is formed by using individual intensities drawn at random from a known distribution of densities (Appendix S1: Table S1).  Because this multiple realization procedure only accommodates one sample point for each generated pattern, the mean of 1000 replications of aggregations of a set number of  sample points (pool size) totaling at least 50,000 sample points was calculated for each estimator. This procedure mimics sampling of widely separated sample points such as the PLS sampling design, conforming to the assumption of independence of measurements and unbiased sampling.

# Simulation of PDE performance under non-CSR patterns: Results for bias 

Performance evaluations of less commonly used plotless estimators and variants (i.e. Shanks, 2nQ, nearest tree, medians) indicate mixed results for CSR patterns (Fig. 2).  The Clark I and Moore I nearest tree PDEs are special cases, and perform slightly worse (1.01–1.03 Q) than their multi-tree parent (Cottam, Pollard) PDEs (0.99–1.02 Q).  The Byth I median joins the other nearest tree estimators as reasonably accurate for CSR patterns. In contrast, all three Shanks (II, IV, 2nQ) estimators overestimate density (1.27–1.84 Q) and the Kline IV estimator gives a more moderate overestimate (1.15 Q).  In general, Shanks and Kline median estimators appear to be inaccurate (> 10% bias) even in the most amenable CSR condition, so may not be appropriate to use as PDEs.  For aggregated patterns most minor estimators strongly underestimate density (Fig. 2).  For the dual inhibited-inhomogeneous process, virtually all these estimators are highly biased, giving underestimates. Only the Morisita 2nQ minor estimator is reasonably accurate for the types of patterns evaluated (0.96–1.03 Q) and allows an alternative and easily calculated replacement for the more biased commonly used Morisita IV estimator (0.92–1.09 Q). 

The commonly applied Cottam, Pollard, and Morisita based (II, IV) PDEs were further evaluated using some dozen simulations for each type of process, with different parameters among simulations (Fig. 3). The true density varied for the CSR process; the parameters governing the level of inhibition or aggregation were varied for inhibition or aggregation processes, respectively; the regional aggregated process varied in the rate of change of the non-stationary true densities over space; and the dual process varied in both the level of inhibition and inhomogeneity (Appendix S1: Table S1). 

The Cottam, Pollard, and Morisita PDEs are all highly accurate under CSR with the Morisita PDEs’ biases (Q) from 0.99 to 1.01 over a range of densities (Fig. 3).  The Cottam and Pollard PDEs slightly overestimate density (1.00–1.03 Q). For inhibition (InHib) processes, the Cottam, Pollard, and Morisita IV PDEs increasingly overestimate density (1.02–1.64 Q) as the level of inhibition grows stronger. Morisita IV remains consistently biased to inhibition (1.05–1.32 Q). In contrast, the Morisita II PDE is robust for the inhibition processes, from less than 2% underestimates for a moderate level of inhibition to 7% underestimates for strong regional regularity. The relationship is reversed for aggregated (Aggreg) processes (Fig. 3) with all, except the Morisita II PDE, increasingly underestimating the true density (minimum accuracy 0.41–0.60 Q). The bias of the Morisita II PDE varies depending on the parameters of the aggregation process but retains low bias (0.97–1.03 Q). Inhomogeneity (InHom) has a similar effect as aggregation with Cottam and Pollard PDEs showing increasing underestimates (0.94–0.23 Q) as non-CSR pattern becomes stronger. As expected from point-based estimators, both Morisita II and IV point estimators are insensitive (0.98–1.04 Q) to inhomogeneity (InHom). 

For the dual inhibited-inhomogeneous process (InH2), there is a tradeoff between the potential underestimates due to aggregation and overestimates due to repulsion. The two countervailing processes are differentially expressed as high density simulations strongly express inhibition while the low density simulations can better express inhomogeneity (Fig. 3). Thus the combination of local inhibition and regional inhomogeneity is both an inverse density gradient as well as varying from strongly inhibited to strongly inhomogeneous.  In this setting, the Cottam and Pollard PDEs tend to underestimate density (0.28–0.36 Q), which increases with strength of the inhomogeneity. The Morisita II PDE retains low bias, from mild underestimates (0.96 Q) with a high level of inhibition to mild overestimates (1.03 Q) with a high level of inhomogeneity.  Morisita IV behaves in a mixed manner reflecting the overestimates (1.20 Q) as seen in inhibited patterns alone, and accurate (0.97–1.05 Q) at the inhomogeneous end of the gradient. The overall balance in the dual simulations is typically an accurate, slight underestimate (2%) for Morisita II and a noteworthy overestimate for Morisita IV.
Overall, Cottam and Pollard PDEs have a substantial bias except under CSR (Fig. 2) giving greater than the true density under inhibition and less than the true density under aggregation. The magnitude of the bias for the Cottam PDE is smaller than that for the Pollard PDE.  If we were to use a criterion of more than 10% difference from true value as ecologically significant (Liu et al. 2011), only the Morisita II PDE is reasonably accurate (< 2% Q) under the simulation settings evaluated.   

In virtually all simulations for inhibited, aggregated, inhomogenous, and dual inhibited-inhomogenous simulations all three indices (Clark-Evans, Pielou, Eberhardt) confirm statistically significant (P < 0.10) non-CSR patterns (Fig. 3, Appendix S1: Table S2). The Clark-Evans statistic (R) of dispersion indicates CSR patterns are between a nearest-neighbor (dispersion) metric of 0.96 and 1.06.  This is equivalent to a Cottam accuracy of between 1.08 Q and 0.89 Q or within about 10% of the true value.  The Pielou (Pollard) dispersion index seems slightly more powerful than the Clark-Evans R (Cottam) index, with higher significance (P < 0.05) in borderline non-CSR patterns. In contrast, the transposed Eberhardt index (E) indicates significant aggregations only for clumped or inhomogeneous patterns (Appendix S1: Table S2). The Eberhardt test is apparently not sensitive to local scale of inhibition, but predictive of inhomogeneous effects.  Previous knowledge of the true density is not necessary, if Cottam or Pollard PDEs are combined with an accurate estimate from the Morisita II PDE.

# Simulation of PDE performance under non-CSR patterns: Results for precision

The bootstrapped precision (CV-100) of density estimates for CSR patterns for all major PDEs, except the Morisita II PDE, are virtually identical to the theoretical precision values of 7.1%–7.4% for Cottam II, Pollard II, and Morisita IV, and 5.0%–5.2% for Cottam IV and Pollard IV (Table 4).  The Morisita II variance is theoretically infinite, while bootstrapping indicates a large empirical value of 22.9% CV-100.  Furthermore this estimate of sampling error for Morisita II is unstable and highly variable due to the scarcity of very high densities (short distances). In field situations this uncertainty is somewhat mitigated since very short distances are eliminated by the point being within the radius of the tree itself or by the tree being too close to the point to be accurately recorded (near tree bias). Since the variance is small in CSR patterns, the RRMSE and theoretical variances are comparable (Table 4).  Overall error (RRMSE) decreases as the number of sample points aggregated into an estimate (sample pool) becomes larger. For all major PDEs under CSR patterns, the estimates from 2-tree corners are only moderately less variable than the 4-tree corners with twice as many trees (Fig. 5).  
The variation of Cottam, Pollard and Morisita IV PDEs for non-CSR processes tend to be slightly greater (< 7% CV-100 inhibited; < 11% CV-100 inhomogeneous or dual inhibited-inhomogeneous) than for CSR processes (Table 4).  Moreover, the bias (Q) for Cottam and Pollard PDEs for clumped, inhomogeneous, or dual inhibited-inhomogeneous patterns are more than 1.645 SE from the true (Q = 1.0) values (Fig. 4). Thus, these estimates are significantly different from true values and statistically ( = 0.10) biased. The precision envelope for the Morisita II PDE contains the true value of Q (Q = 1.0), but has considerable variability (11%–23% CV-100) around it. For the range of simulated processes examined, there is a bias-variance tradeoff in choosing the appropriate estimator.  For CSR patterns, all estimators have low bias and the Cottam, Pollard, and Morisita IV PDEs have smaller variance than the Morisita II PDE. As the simulation process deviates further from the CSR assumption, Morisita II PDE has low bias, but retains poorer precision than the other estimators. The combination of accuracy,  precision, and pool size results in Morisita II PDE outperforming other PDEs, if the Clark-Evans index of deviation from CSR is less than R = 0.95 (aggregated) or greater than R = 1.05 (regular) (Figs. 3, 4,Table 4).  
